# Rails Application for pgsqlite Testing

This is a comprehensive Rails 8.0 API application designed to test pgsqlite compatibility with Rails and Active Record.

## Features

This Rails application demonstrates full PostgreSQL compatibility with the following features:

### PostgreSQL-Specific Features
- **GENERATED BY DEFAULT AS IDENTITY** columns (Rails 5.1+ identity columns)
- **UUID primary keys** with pgcrypto extension (Rails 6+ default)
- **PostgreSQL arrays** with native Rails support
- **JSONB fields** with store_attribute helpers (Rails 4.2+ native)
- **Complex associations** (has_many, belongs_to, many-to-many)
- **Database constraints** backing Rails validations
- **Full-text search** using PostgreSQL tsvector
- **GIN indexes** on arrays and JSONB fields
- **Hierarchical data** with self-referencing models

### Models
1. **Author** - Authors with IDENTITY columns, JSONB metadata, array fields
2. **Publisher** - Publishing companies with JSONB contact info
3. **Genre** - Hierarchical categories with parent-child relationships
4. **Book** - Main model with UUID, arrays, JSONB, comprehensive PostgreSQL features
5. **Review** - User reviews with ratings and JSONB metadata
6. **BookInventory** - Inventory management with arrays and JSONB supply chain data
7. **BookGenre** - Many-to-many join table for books and genres

### API Endpoints
- `GET /api/v1/authors` - List authors with filtering
- `POST /api/v1/authors` - Create new author
- `GET /api/v1/books` - List books with complex filtering
- `POST /api/v1/books` - Create new book
- `GET /api/v1/books/search?q=query` - Full-text search
- `GET /api/v1/books/:id/reviews` - Book reviews
- `POST /api/v1/books/:id/reviews` - Create review
- And many more...

## Database Schema

The Rails migrations include:
- Identity columns using `GENERATED BY DEFAULT AS IDENTITY`
- UUID columns with `gen_random_uuid()`
- PostgreSQL arrays with default values
- JSONB columns with GIN indexes
- Check constraints for data validation
- Full-text search setup with triggers
- Complex foreign key relationships

## Testing with pgsqlite

To test this Rails application with pgsqlite:

1. Start pgsqlite server:
   ```bash
   pgsqlite --database rails_test.db --port 5433
   ```

2. Run the Rails application:
   ```bash
   cd tests/rails_app
   bundle install
   rails db:create db:migrate db:seed
   rails server -p 3001
   ```

3. Test the API endpoints:
   ```bash
   # List books
   curl http://localhost:3001/api/v1/books

   # Search books
   curl http://localhost:3001/api/v1/books/search?q=classic

   # Create author
   curl -X POST http://localhost:3001/api/v1/authors \
     -H "Content-Type: application/json" \
     -d '{"author": {"name": "Test Author", "email": "test@example.com"}}'
   ```

## Comprehensive PostgreSQL Feature Testing

This application tests all major PostgreSQL features that Rails applications typically use:

- ✅ Rails identity columns (GENERATED BY DEFAULT AS IDENTITY)
- ✅ UUID primary keys with proper Rails integration
- ✅ PostgreSQL arrays with Rails array helpers
- ✅ JSONB with Rails store_attribute pattern
- ✅ Complex Active Record associations
- ✅ Rails validations with database constraints
- ✅ Full-text search with PostgreSQL tsvector
- ✅ Hierarchical data with Rails tree patterns
- ✅ Rails enum-style validations
- ✅ Database introspection for Rails migrations
- ✅ Comprehensive indexing strategies

This ensures pgsqlite provides complete Rails compatibility for production applications.